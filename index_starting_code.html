<html>
  <head>
    <title>Simple Geometry Test</title>
  </head>

  <style>
  body {margin: 0;}
  canvas {width: 100%; height: 100%;}
  </style>

  <body>
    <!--include the three.js library-->
    <script src="js/three.js"> </script>
    <!--and the trackball code-->
    <script src="js/OrbitControls.js"> </script>
    <!--the model loader-->
    <script src="js/PLYLoader.js"></script>

    <style>
    			body {
    				font-family: Monospace;
    				background-color: #000;
    				color: #fff;
    				margin: 0px;
    				overflow: hidden;
    			}
    			#info {
    				position: absolute;
    				top: 10px;
    				width: 100%;
    				text-align: center;
    			}
    </style>

    <div id="info">
      <p>This is a threeJS Test<br>
        <p> <button onclick="CubeSpawner()">Spawn a Cube</button> <br>
        <p> <button onclick="bunnySpinner()">Rotate Object</button> <br>
          <button onclick="bunnyCamo()">Make Selected camo texture</button> <br>
             <button onclick="bunnyBW()">Make Selected black and white texture</button> <br>

    </div>

    <script>

      var scene = new THREE.Scene( );
      var renderer = new THREE.WebGLRenderer( );

      renderer.setSize(window.innerWidth,window.innerHeight);

      document.body.appendChild(renderer.domElement );

      var ratio = window.innerWidth/window.innerHeight;
      var camera = new THREE.PerspectiveCamera(45,ratio,0.1,1000);
      camera.position.set(0,0,20);
  	  camera.lookAt(0,0,1);

      var material_floor = new THREE.MeshLambertMaterial();
      material_floor.map =camo_texture; //Not sure why its camo but doesnt do anything.
      material_floor.color= new THREE.Color(0x93bcff);
      material_floor.side=THREE.DoubleSide;

      var camo_texture = new THREE.TextureLoader().load('texture/camo.jpg');
      var bw_texture = new THREE.TextureLoader().load('texture/bw.jpg');
      var flower_texture = new THREE.TextureLoader().load('texture/flower.jpg');


      var material_camo = new THREE.MeshPhongMaterial();
      material_camo.color=  new THREE.Color(1,1,1);
      material_camo.map = camo_texture;
      material_camo.wireframe=false;

      var material_bw = new THREE.MeshLambertMaterial();
      material_bw.color=  new THREE.Color(1,1,1);
      material_bw.map = bw_texture;
      material_bw.wireframe=false;

      var material_flower = new THREE.MeshLambertMaterial();
      material_flower.color=  new THREE.Color(1,1,1);
      material_flower.map = flower_texture;
      material_flower.wireframe=false;

      var geometry_plane = new THREE.PlaneGeometry(10,10,10,10);
      var floorMesh= new THREE.Mesh(geometry_plane,material_floor);
      scene.add(floorMesh);



      controls = new THREE.OrbitControls( camera, renderer.domElement );

      var cameralight = new THREE.PointLight( new THREE.Color(1,1,1), 0.5 );
      camera.add( cameralight );
      scene.add(camera);

      var ambientlight = new THREE.AmbientLight(new THREE.Color(1,1,1),0.2);
      scene.add(ambientlight);


      var size = 10;
      var divisions = 3;
      var red = new THREE.Color(0xff0026);

      var gridHelper = new THREE.GridHelper( size, divisions, 0xe2e2e2 , red);
      scene.add( gridHelper );
      gridHelper.rotation.x = Math.PI / 2;
      gridHelper.position.z = 0;
      gridHelper.Color = red;

      //MESH LOADING



      var MyUpdateLoop = function ( )
      {
        renderer.render(scene,camera);
        requestAnimationFrame(MyUpdateLoop);
      };

      requestAnimationFrame(MyUpdateLoop);
      var selectedObject = null;
      var raycaster = new THREE.Raycaster();

      var A1 = false;
      var A2 = false;
      var A3 = false;
      var B1 = false;
      var B2 = false;
      var B3 = false;
      var C1 = false;
      var C2 = false;
      var C3 = false;



      var onMouseDown = function(event) {
        var coordinates = new THREE.Vector2();
        coordinates.x = event.clientX / renderer.domElement.clientWidth*2 - 1;
            coordinates.y = (event.clientY / renderer.domElement.clientHeight*2 - 1)*-1;
        raycaster.setFromCamera(coordinates, camera);

        var intersects = raycaster.intersectObjects(scene.children, false);

        if (intersects.length > 0) {

          if (selectedObject != null) {
            var pos = intersects[0].point;
//A GRID ROW
            if (pos.x < -1.6665 && pos.y > 1.6665 && pos.y < 5 && A1 == false) {
            selectedObject.position.x = -3.3333;
            selectedObject.position.y = 3.3333;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
              A1 = true;
              console.log("A1 has been occupied")
            }
            else if (pos.x < -1.6665 && pos.y > 1.6665 && pos.y < 5 && A1 == true){
              console.log("A1 Occupied");
            }

            if (pos.x > -1.6665 && pos.x < 1.6665 && pos.y > 1.6665 && pos.y < 5 && A2 == false) {
            selectedObject.position.x = 0;
            selectedObject.position.y = 3.3333;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
              A2 = true;
              console.log("A2 has been occupied")
            }
            else if (pos.x > -1.6665 && pos.x < 1.6665 && pos.y > 1.6665 && pos.y < 5 && A2 == true){
              console.log("A2 Occupied");
            }

            if (pos.x > 1.6665 && pos.y > 1.6665 && pos.y < 5 && A3 == false) {
            selectedObject.position.x = 3.3333;
            selectedObject.position.y = 3.333;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
              A3 = true;
              console.log("A3 has been occupied")
            }
            else if (pos.x > 1.6665 && pos.y > 1.6665 && pos.y < 5 && A3 == true){
              console.log("A3 Occupied");
            }

// B GRID ROW
            if (pos.x < -1.6665 && pos.y > -1.6665 && pos.y < 1.6665 && B1 == false) {
            selectedObject.position.x = -3.3333;
            selectedObject.position.y = 0;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
            console.log("B1 has been occupied");
              B1 = true;
            }
            else if (pos.x < -1.6665 && pos.y > -1.6665 && pos.y < 1.6665 && B1 == true){
              console.log("B1 Occupied");
            }

            if (pos.x > -1.6665 && pos.x < 1.6665 && pos.y > -1.6665 && pos.y < 1.6665 && B2 == false) {
            selectedObject.position.x = 0;
            selectedObject.position.y = 0;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
              B2 = true;
              console.log("B2 has been occupied");
            }
            else if (pos.x > -1.6665 && pos.x < 1.6665 && pos.y > -1.6665 && pos.y < 1.6665 && B2 == true){
              console.log("B2 Occupied");
            }

            if (pos.x > 1.6665 && pos.y > -1.6665 && pos.y < 1.6665 && B3 == false) {
            selectedObject.position.x = 3.3333;
            selectedObject.position.y = 0;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
              B3 = true;
              console.log("B3 has been occupied");
            }
            else if (pos.x > 1.6665 && pos.y > -1.6665 && pos.y < 1.6665 && B3 == true){
              console.log("B3 Occupied");
            }

// C Row
            if (pos.x < -1.6665 && pos.y < -1.6665 && C1 == false) {
            selectedObject.position.x = -3.3333;
            selectedObject.position.y = -3.3333;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
            console.log("C1 has been occupied");
              C1 = true;
            }
            else if (pos.x < -1.6665 && pos.y < -1.6665 && C1 == true){
              console.log("C1 Occupied");
            }

            if (pos.x > -1.6665 && pos.x < 1.6665 && pos.y < -1.6665 && C2 == false) {
            selectedObject.position.x = 0;
            selectedObject.position.y = -3.3333;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
              C2 = true;
              console.log("C2 has been occupied");
            }
            else if (pos.x > -1.6665 && pos.x < 1.6665 && pos.y < -1.6665 && C2 == true){
              console.log("C2 Occupied");
            }

            if (pos.x > 1.6665 && pos.y < -1.6665 && C3 == false) {
            selectedObject.position.x = 3.3333;
            selectedObject.position.y = -3.3333;
            selectedObject.material.color = new THREE.Color(.9,0.9,0.9);
            selectedObject = null;
              C3 = true;
              console.log("C3 has been occupied");
            }
            else if (pos.x > 1.6665 && pos.y < -1.6665 && C3 == true){
              console.log("C3 Occupied");
            }
          }

// A GRID ROW
        else if (selectedObject == null && intersects[0].object != floorMesh && intersects[0].object != gridHelper){
          selectedObject = intersects[0].object;
          selectedObject.material.color = new THREE.Color(1,0.5,0.5);

          if (selectedObject.position.x < -1.6665 && selectedObject.position.y > 1.6665 && selectedObject.position.y < 5) {
            A1 = false;
          }
          if (selectedObject.position.x > -1.6665 && selectedObject.position.x < 1.6665 && selectedObject.position.y > 1.6665 && selectedObject.position.y < 5) {
            A2 = false;
          }
          if (selectedObject.position.x > 1.6665 && selectedObject.position.y > 1.6665 && selectedObject.position.y < 5) {
            A3 = false;
          }

// B GRID ROW
          if (selectedObject.position.x < -1.6665 && selectedObject.position.y > -1.6665 && selectedObject.position.y < 1.6665) {
            B1 = false;
          }
          if (selectedObject.position.x > -1.6665 && selectedObject.position.x < 1.6665 && selectedObject.position.y > -1.6665 && selectedObject.position.y < 1.6665) {
            B2 = false;
          }
          if (selectedObject.position.x > 1.6665 && selectedObject.position.y > -1.6665 && selectedObject.position.y < 1.6665) {
            B3 = false;
          }

// C GRID ROW
          if (selectedObject.position.x < -1.6665 && selectedObject.position.y < -1.6665) {
            C1 = false;
          }
          if (selectedObject.position.x > -1.6665 && selectedObject.position.y < -1.6665) {
            C2 = false;
          }
          if (selectedObject.position.x > 1.6665 && selectedObject.position.y < -1.6665) {
            C3 = false;
          }

      }
        }
      }

      var changed = false;

      document.addEventListener('mousedown', onMouseDown);

      function CubeSpawner() {
        var geometry_cube = new THREE.BoxGeometry(2.5,2.5,2.5);
        var cube_mesh = new THREE.Mesh(geometry_cube,material_bw);
        cube_mesh.position.x= + 7;
        cube_mesh.position.z= 3;
        scene.add(cube_mesh);
      }

      function bunnySpinner() {
        selectedObject.rotation.z += Math.PI / 4;
      }
      function bunnyCamo() {
        selectedObject.traverse(function(child) {
            if (child instanceof THREE.Mesh){
                child.material = material_camo;
            }
      });
    }
    function bunnyBW() {
      selectedObject.traverse(function(child) {
          if (child instanceof THREE.Mesh){
              child.material = material_bw;
          }
    });
  }


      //onclick = selectedObject.rotation.y = Math.PI / 2;

      //this function is called when the window is resized
      var MyResize = function ( )
      {
        //get the new sizes
        var width = window.innerWidth;
        var height = window.innerHeight;
        //then update the renderer
        renderer.setSize(width,height);
        //and update the aspect ratio of the camera
        camera.aspect = width/height;
        //update the projection matrix given the new values
        camera.updateProjectionMatrix();

        //and finally render the scene again
        renderer.render(scene,camera);
      };
      //link the resize of the window to the update of the camera
      window.addEventListener( 'resize', MyResize);

    </script>
  </body>
</html>
